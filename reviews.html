<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reviews & Reflection | SelfMaster</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="data.js"></script>
    <script src="script.js"></script>
</head>
<body>
    <header>
    <div class="container header-content">
        <div class="logo">
            <i class="fas fa-brain"></i>
            <span><a href="index.html" style="color: inherit; text-decoration: none;">SelfMaster</a></span>
        </div>
        <nav id="main-nav">
            <ul>
                <li><a href="tasks.html"><i class="fas fa-tasks"></i> Tasks</a></li>
                <li><a href="projects.html"><i class="fas fa-project-diagram"></i> Projects</a></li>
                <li><a href="calendar.html"><i class="fas fa-calendar"></i> Calendar</a></li>
                <li><a href="goals.html"><i class="fas fa-bullseye"></i> Goals</a></li>
                <li><a href="habits.html"><i class="fas fa-running"></i> Habits</a></li>
                <li><a href="notes.html"><i class="fas fa-sticky-note"></i> Notes</a></li>
                <li><a href="reviews.html"><i class="fas fa-chart-bar"></i> Reviews</a></li>
                <li><a href="analytics.html"><i class="fas fa-chart-line"></i> Analytics</a></li>
            </ul>
        </nav>
        <button class="mobile-menu-btn">
            <i class="fas fa-bars"></i>
        </button>
    </div>
</header>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1><i class="fas fa-chart-bar"></i> Reviews & Reflection</h1>
            <p>Reflect on your progress, learn from experiences, and plan for improvement</p>
        </div>
    </section>

    <!-- Review Types -->
    <section class="review-types">
        <div class="container">
            <h2 class="section-title">Review Templates</h2>
            <div class="review-templates-grid">
                <div class="review-template-card" onclick="startReview('daily')">
                    <div class="template-icon">
                        <i class="fas fa-sun"></i>
                    </div>
                    <h3>Daily Review</h3>
                    <p>Quick reflection on today's achievements and tomorrow's priorities</p>
                    <div class="template-duration">5-10 minutes</div>
                </div>
                <div class="review-template-card" onclick="startReview('weekly')">
                    <div class="template-icon">
                        <i class="fas fa-calendar-week"></i>
                    </div>
                    <h3>Weekly Review</h3>
                    <p>Comprehensive review of the week's progress and planning for next week</p>
                    <div class="template-duration">30-60 minutes</div>
                </div>
                <div class="review-template-card" onclick="startReview('monthly')">
                    <div class="template-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <h3>Monthly Review</h3>
                    <p>Strategic assessment of monthly goals and overall progress</p>
                    <div class="template-duration">60-90 minutes</div>
                </div>
                <div class="review-template-card" onclick="startReview('quarterly')">
                    <div class="template-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h3>Quarterly Review</h3>
                    <p>High-level assessment of quarterly goals and strategic direction</p>
                    <div class="template-duration">2-3 hours</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Active Review -->
    <section class="active-review">
        <div class="container">
            <div class="review-container" id="review-container">
                <div class="review-header">
                    <h2 id="review-title">Select a Review Template to Begin</h2>
                    <div class="review-progress">
                        <div class="progress-bar">
                            <div class="progress" id="review-progress-bar" style="width: 0%"></div>
                        </div>
                        <span id="review-progress-text">0% Complete</span>
                    </div>
                </div>
                
                <div class="review-content" id="review-content">
                    <div class="empty-review-state">
                        <i class="fas fa-clipboard-list fa-4x"></i>
                        <h3>No Active Review</h3>
                        <p>Select a review template from above to start your reflection process.</p>
                        <p class="review-tip">
                            <i class="fas fa-lightbulb"></i>
                            Regular reviews help you stay aligned with your goals and make continuous improvements.
                        </p>
                    </div>
                </div>
                
                <div class="review-actions" id="review-actions" style="display: none;">
                    <button class="btn" onclick="saveReview()">
                        <i class="fas fa-save"></i> Save Review
                    </button>
                    <button class="btn btn-outline" onclick="cancelReview()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="btn" onclick="exportReview()" style="margin-left: auto;">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Review History -->
    <section class="review-history">
        <div class="container">
            <h2 class="section-title">Review History</h2>
            <div class="history-controls">
                <div class="filter-controls">
                    <select id="review-type-filter" onchange="loadReviewHistory()">
                        <option value="all">All Review Types</option>
                        <option value="daily">Daily Reviews</option>
                        <option value="weekly">Weekly Reviews</option>
                        <option value="monthly">Monthly Reviews</option>
                        <option value="quarterly">Quarterly Reviews</option>
                    </select>
                    <select id="review-date-filter" onchange="loadReviewHistory()">
                        <option value="all">All Time</option>
                        <option value="month">Last Month</option>
                        <option value="quarter">Last Quarter</option>
                        <option value="year">Last Year</option>
                    </select>
                </div>
                <div class="search-controls">
                    <input type="text" id="review-search" placeholder="Search reviews..." onkeyup="searchReviews()">
                    <i class="fas fa-search"></i>
                </div>
            </div>
            
            <div class="history-list" id="history-list">
                <!-- Review history will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Insights & Patterns -->
    <section class="review-insights">
        <div class="container">
            <h2 class="section-title">Insights & Patterns</h2>
            <div class="insights-grid">
                <div class="insight-card">
                    <div class="insight-header">
                        <i class="fas fa-trophy"></i>
                        <h3>Most Common Achievements</h3>
                    </div>
                    <div class="insight-content" id="common-achievements">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
                <div class="insight-card">
                    <div class="insight-header">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Frequent Challenges</h3>
                    </div>
                    <div class="insight-content" id="common-challenges">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
                <div class="insight-card">
                    <div class="insight-header">
                        <i class="fas fa-lightbulb"></i>
                        <h3>Key Learnings</h3>
                    </div>
                    <div class="insight-content" id="key-learnings">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
                <div class="insight-card">
                    <div class="insight-header">
                        <i class="fas fa-chart-line"></i>
                        <h3>Progress Trend</h3>
                    </div>
                    <div class="insight-content">
                        <div class="trend-indicator" id="progress-trend">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Action Items from Reviews -->
    <section class="review-actions-section">
        <div class="container">
            <h2 class="section-title">Action Items from Reviews</h2>
            <div class="actions-list" id="actions-list">
                <!-- Action items will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Review Statistics -->
    <section class="review-statistics">
        <div class="container">
            <div class="stats-grid">
                <div class="stats-card">
                    <div class="stat-icon">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="total-reviews">0</div>
                        <div class="stat-label">Total Reviews</div>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stat-icon">
                        <i class="fas fa-fire"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="review-streak">0</div>
                        <div class="stat-label">Current Streak</div>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="actions-completed">0%</div>
                        <div class="stat-label">Actions Completed</div>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stat-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="consistency-rate">0%</div>
                        <div class="stat-label">Consistency Rate</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h4>SelfMaster</h4>
                    <p>Your comprehensive personal management system designed to help you take control of your life, build better habits, and achieve your goals.</p>
                </div>
                <div class="footer-column">
                    <h4>Review Methods</h4>
                    <ul>
                        <li><a href="#">5-4-3-2-1 Method</a></li>
                        <li><a href="#">Start-Stop-Continue</a></li>
                        <li><a href="#">Rose-Bud-Thorn</a></li>
                        <li><a href="#">SWOT Analysis</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Reflection Tools</h4>
                    <ul>
                        <li><a href="#">Journal Prompts</a></li>
                        <li><a href="#">Progress Tracking</a></li>
                        <li><a href="#">Decision Logs</a></li>
                        <li><a href="#">Learning Journals</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 SelfMaster. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Reviews page specific functionality
        let currentReview = null;
        let currentReviewType = null;
        let reviewAnswers = {};
        
        const reviewTemplates = {
            daily: {
                title: "Daily Review",
                duration: "5-10 minutes",
                questions: [
                    {
                        id: "achievements",
                        question: "What were my top 3 achievements today?",
                        type: "textarea",
                        rows: 3
                    },
                    {
                        id: "challenges",
                        question: "What challenges did I face today?",
                        type: "textarea",
                        rows: 2
                    },
                    {
                        id: "learnings",
                        question: "What did I learn today?",
                        type: "textarea",
                        rows: 2
                    },
                    {
                        id: "gratitude",
                        question: "What am I grateful for today?",
                        type: "textarea",
                        rows: 2
                    },
                    {
                        id: "energy",
                        question: "What was my energy level today? (1-10)",
                        type: "range",
                        min: 1,
                        max: 10,
                        value: 5
                    },
                    {
                        id: "tomorrow",
                        question: "What are my top 3 priorities for tomorrow?",
                        type: "textarea",
                        rows: 3
                    }
                ]
            },
            weekly: {
                title: "Weekly Review",
                duration: "30-60 minutes",
                questions: [
                    {
                        id: "accomplishments",
                        question: "What were my major accomplishments this week?",
                        type: "textarea",
                        rows: 4
                    },
                    {
                        id: "goal_progress",
                        question: "How did I progress on my weekly goals?",
                        type: "textarea",
                        rows: 3
                    },
                    {
                        id: "challenges",
                        question: "What were the biggest challenges this week?",
                        type: "textarea",
                        rows: 3
                    },
                    {
                        id: "lessons",
                        question: "What lessons did I learn this week?",
                        type: "textarea",
                        rows: 3
                    },
                    {
                        id: "start_stop_continue",
                        question: "What should I START, STOP, and CONTINUE doing?",
                        type: "textarea",
                        rows: 3
                    },
                    {
                        id: "energy_patterns",
                        question: "When was I most/least productive and energetic?",
                        type: "textarea",
                        rows: 2
                    },
                    {
                        id: "next_week_goals",
                        question: "What are my goals for next week?",
                        type: "textarea",
                        rows: 4
                    },
                    {
                        id: "weekly_rating",
                        question: "How would I rate this week overall? (1-10)",
                        type: "range",
                        min: 1,
                        max: 10,
                        value: 5
                    }
                ]
            },
            monthly: {
                title: "Monthly Review",
                duration: "60-90 minutes",
                questions: [
                    {
                        id: "monthly_achievements",
                        question: "What were my biggest achievements this month?",
                        type: "textarea",
                        rows: 4
                    },
                    {
                        id: "goal_review",
                        question: "How did I progress on my monthly goals?",
                        type: "textarea",
                        rows: 4
                    },
                    {
                        id: "habits_review",
                        question: "How consistent was I with my habits?",
                        type: "textarea",
                        rows: 3
                    },
                    {
                        id: "key_learnings",
                        question: "What were the most important lessons learned?",
                        type: "textarea",
                        rows: 3
                    },
                    {
                        id: "challenges_overcome",
                        question: "What challenges did I overcome?",
                        type: "textarea",
                        rows: 3
                    },
                    {
                        id: "areas_improvement",
                        question: "What areas need improvement?",
                        type: "textarea",
                        rows: 3
                    },
                    {
                        id: "next_month_goals",
                        question: "What are my goals for next month?",
                        type: "textarea",
                        rows: 4
                    },
                    {
                        id: "action_items",
                        question: "What specific actions will I take next month?",
                        type: "textarea",
                        rows: 4
                    },
                    {
                        id: "monthly_rating",
                        question: "How would I rate this month overall? (1-10)",
                        type: "range",
                        min: 1,
                        max: 10,
                        value: 5
                    }
                ]
            }
        };
        
        function startReview(type) {
            currentReviewType = type;
            const template = reviewTemplates[type];
            
            if (!template) {
                alert('Review template not found');
                return;
            }
            
            // Reset answers
            reviewAnswers = {};
            
            // Update UI
            document.getElementById('review-title').textContent = `${template.title} - ${template.duration}`;
            
            // Generate review questions
            const reviewContent = document.getElementById('review-content');
            reviewContent.innerHTML = '';
            
            template.questions.forEach((q, index) => {
                const questionElement = document.createElement('div');
                questionElement.className = 'review-question-item';
                questionElement.dataset.questionId = q.id;
                
                let inputHtml = '';
                switch(q.type) {
                    case 'textarea':
                        inputHtml = `<textarea id="answer-${q.id}" rows="${q.rows || 3}" placeholder="Type your answer here..." oninput="updateReviewProgress()"></textarea>`;
                        break;
                    case 'range':
                        inputHtml = `
                            <div class="range-input-container">
                                <input type="range" id="answer-${q.id}" min="${q.min}" max="${q.max}" value="${q.value}" oninput="updateRangeValue('${q.id}')">
                                <span class="range-value" id="range-value-${q.id}">${q.value}</span>
                            </div>
                        `;
                        break;
                }
                
                questionElement.innerHTML = `
                    <div class="question-header">
                        <span class="question-number">${index + 1}</span>
                        <h4>${q.question}</h4>
                    </div>
                    <div class="question-input">
                        ${inputHtml}
                    </div>
                `;
                
                reviewContent.appendChild(questionElement);
            });
            
            // Show action buttons
            document.getElementById('review-actions').style.display = 'flex';
            
            // Reset progress
            updateReviewProgress();
            
            // Scroll to review section
            document.querySelector('.active-review').scrollIntoView({ behavior: 'smooth' });
        }
        
        function updateRangeValue(questionId) {
            const rangeInput = document.getElementById(`answer-${questionId}`);
            const rangeValue = document.getElementById(`range-value-${questionId}`);
            if (rangeInput && rangeValue) {
                rangeValue.textContent = rangeInput.value;
                updateReviewProgress();
            }
        }
        
        function updateReviewProgress() {
            const template = reviewTemplates[currentReviewType];
            if (!template) return;
            
            const questions = template.questions;
            let answered = 0;
            
            questions.forEach(q => {
                const input = document.getElementById(`answer-${q.id}`);
                if (input) {
                    if (q.type === 'textarea') {
                        if (input.value.trim().length > 0) answered++;
                    } else if (q.type === 'range') {
                        // Range inputs are always considered answered
                        answered++;
                    }
                }
            });
            
            const progress = Math.round((answered / questions.length) * 100);
            document.getElementById('review-progress-bar').style.width = `${progress}%`;
            document.getElementById('review-progress-text').textContent = `${progress}% Complete`;
        }
        
        function saveReview() {
            if (!currentReviewType) return;
            
            const template = reviewTemplates[currentReviewType];
            const answers = {};
            
            // Collect all answers
            template.questions.forEach(q => {
                const input = document.getElementById(`answer-${q.id}`);
                if (input) {
                    answers[q.id] = input.value;
                }
            });
            
            // Generate action items from answers
            const actionItems = generateActionItems(answers, currentReviewType);
            
            const review = {
                id: Date.now(),
                type: currentReviewType,
                title: template.title,
                date: new Date().toISOString(),
                answers: answers,
                actionItems: actionItems,
                completed: false
            };
            
            // Save to localStorage
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            reviews.push(review);
            localStorage.setItem('reviews', JSON.stringify(reviews));
            
            // Create tasks from action items
            createTasksFromActionItems(actionItems, `${template.title} - ${new Date().toLocaleDateString()}`);
            
            // Reset UI
            cancelReview();
            
            // Reload history and insights
            loadReviewHistory();
            updateReviewInsights();
            loadActionItems();
            updateReviewStatistics();
            
            // Show success message
            alert('Review saved successfully! Action items have been added to your tasks.');
        }
        
        function generateActionItems(answers, reviewType) {
            const actionItems = [];
            
            // Extract action items from answers
            Object.entries(answers).forEach(([key, value]) => {
                if (value && typeof value === 'string') {
                    // Look for action-oriented phrases
                    const lines = value.split('\n');
                    lines.forEach(line => {
                        const trimmedLine = line.trim();
                        if (trimmedLine.length > 0) {
                            // Check for action indicators
                            if (trimmedLine.toLowerCase().startsWith('i will') ||
                                trimmedLine.toLowerCase().includes('need to') ||
                                trimmedLine.toLowerCase().includes('should') ||
                                trimmedLine.toLowerCase().includes('must') ||
                                trimmedLine.toLowerCase().includes('action:')) {
                                
                                actionItems.push({
                                    id: Date.now() + Math.random(),
                                    text: trimmedLine,
                                    source: key,
                                    completed: false,
                                    createdAt: new Date().toISOString()
                                });
                            }
                        }
                    });
                }
            });
            
            return actionItems;
        }
        
        function createTasksFromActionItems(actionItems, source) {
            const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
            
            actionItems.forEach(item => {
                const task = {
                    id: Date.now() + Math.random(),
                    title: item.text.substring(0, 100),
                    description: `From review: ${source}`,
                    priority: 'medium',
                    dueDate: null,
                    completed: false,
                    createdAt: new Date().toISOString(),
                    tags: ['review', 'action-item']
                };
                
                tasks.push(task);
            });
            
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }
        
        function cancelReview() {
            currentReviewType = null;
            reviewAnswers = {};
            
            // Reset UI
            document.getElementById('review-title').textContent = 'Select a Review Template to Begin';
            document.getElementById('review-content').innerHTML = `
                <div class="empty-review-state">
                    <i class="fas fa-clipboard-list fa-4x"></i>
                    <h3>No Active Review</h3>
                    <p>Select a review template from above to start your reflection process.</p>
                    <p class="review-tip">
                        <i class="fas fa-lightbulb"></i>
                        Regular reviews help you stay aligned with your goals and make continuous improvements.
                    </p>
                </div>
            `;
            document.getElementById('review-actions').style.display = 'none';
            document.getElementById('review-progress-bar').style.width = '0%';
            document.getElementById('review-progress-text').textContent = '0% Complete';
        }
        
        function exportReview() {
            if (!currentReviewType) return;
            
            const template = reviewTemplates[currentReviewType];
            const answers = {};
            
            // Collect all answers
            template.questions.forEach(q => {
                const input = document.getElementById(`answer-${q.id}`);
                if (input) {
                    answers[q.id] = input.value;
                }
            });
            
            // Create export content
            const exportContent = `
SelfMaster Review Export
========================
Review Type: ${template.title}
Date: ${new Date().toLocaleDateString()}
Time: ${new Date().toLocaleTimeString()}

${template.questions.map((q, i) => `
${i + 1}. ${q.question}
${answers[q.id] || 'No answer provided'}
${'-'.repeat(50)}
`).join('\n')}

Action Items:
${generateActionItems(answers, currentReviewType).map(item => `- ${item.text}`).join('\n')}
            `;
            
            // Create download
            const blob = new Blob([exportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `review-${currentReviewType}-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function loadReviewHistory() {
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            const typeFilter = document.getElementById('review-type-filter').value;
            const dateFilter = document.getElementById('review-date-filter').value;
            
            let filteredReviews = reviews;
            
            // Apply type filter
            if (typeFilter !== 'all') {
                filteredReviews = filteredReviews.filter(review => review.type === typeFilter);
            }
            
            // Apply date filter
            const now = new Date();
            if (dateFilter !== 'all') {
                let cutoffDate = new Date();
                
                switch(dateFilter) {
                    case 'month':
                        cutoffDate.setMonth(now.getMonth() - 1);
                        break;
                    case 'quarter':
                        cutoffDate.setMonth(now.getMonth() - 3);
                        break;
                    case 'year':
                        cutoffDate.setFullYear(now.getFullYear() - 1);
                        break;
                }
                
                filteredReviews = filteredReviews.filter(review => {
                    const reviewDate = new Date(review.date);
                    return reviewDate >= cutoffDate;
                });
            }
            
            // Sort by date (newest first)
            filteredReviews.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const historyList = document.getElementById('history-list');
            
            if (filteredReviews.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-history fa-3x"></i>
                        <h3>No Review History</h3>
                        <p>Complete your first review to see it here!</p>
                    </div>
                `;
                return;
            }
            
            historyList.innerHTML = filteredReviews.map(review => `
                <div class="history-item">
                    <div class="history-header">
                        <div class="history-title">
                            <h4>${review.title}</h4>
                            <span class="history-date">${formatDate(new Date(review.date))}</span>
                        </div>
                        <div class="history-type">
                            <span class="type-badge type-${review.type}">${review.type}</span>
                        </div>
                    </div>
                    <div class="history-preview">
                        ${Object.entries(review.answers).slice(0, 2).map(([key, value]) => `
                            <div class="preview-item">
                                <strong>${key.replace(/_/g, ' ')}:</strong>
                                <p>${value ? value.substring(0, 100) + (value.length > 100 ? '...' : '') : 'No answer'}</p>
                            </div>
                        `).join('')}
                    </div>
                    <div class="history-actions">
                        <button class="btn-small" onclick="viewFullReview(${review.id})">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="btn-small btn-outline" onclick="deleteReview(${review.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function searchReviews() {
            const searchTerm = document.getElementById('review-search').value.toLowerCase();
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            
            const filteredReviews = reviews.filter(review => {
                // Search in title
                if (review.title.toLowerCase().includes(searchTerm)) return true;
                
                // Search in answers
                for (const [key, value] of Object.entries(review.answers)) {
                    if (value && value.toLowerCase().includes(searchTerm)) {
                        return true;
                    }
                }
                
                return false;
            });
            
            const historyList = document.getElementById('history-list');
            
            if (filteredReviews.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search fa-3x"></i>
                        <h3>No Reviews Found</h3>
                        <p>No reviews match your search criteria.</p>
                    </div>
                `;
                return;
            }
            
            historyList.innerHTML = filteredReviews.map(review => `
                <div class="history-item">
                    <div class="history-header">
                        <div class="history-title">
                            <h4>${highlightText(review.title, searchTerm)}</h4>
                            <span class="history-date">${formatDate(new Date(review.date))}</span>
                        </div>
                        <div class="history-type">
                            <span class="type-badge type-${review.type}">${review.type}</span>
                        </div>
                    </div>
                    <div class="history-preview">
                        ${Object.entries(review.answers).slice(0, 2).map(([key, value]) => `
                            <div class="preview-item">
                                <strong>${key.replace(/_/g, ' ')}:</strong>
                                <p>${value ? highlightText(value.substring(0, 100), searchTerm) + (value.length > 100 ? '...' : '') : 'No answer'}</p>
                            </div>
                        `).join('')}
                    </div>
                    <div class="history-actions">
                        <button class="btn-small" onclick="viewFullReview(${review.id})">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="btn-small btn-outline" onclick="deleteReview(${review.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function highlightText(text, searchTerm) {
            if (!searchTerm || !text) return text;
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return text.replace(regex, '<mark>$1</mark>');
        }
        
        function viewFullReview(reviewId) {
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            const review = reviews.find(r => r.id === reviewId);
            
            if (!review) {
                alert('Review not found');
                return;
            }
            
            // Create modal or new page to view full review
            const modal = document.createElement('div');
            modal.className = 'review-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                padding: 2rem;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.className = 'review-modal-content';
            modalContent.style.cssText = `
                background-color: white;
                border-radius: var(--border-radius);
                padding: 2rem;
                max-width: 800px;
                max-height: 90vh;
                overflow-y: auto;
                width: 100%;
            `;
            
            // Build modal content
            let contentHtml = `
                <div class="modal-header">
                    <h2>${review.title}</h2>
                    <p>${formatDate(new Date(review.date))} • ${review.type} review</p>
                    <button class="modal-close" onclick="this.closest('.review-modal').remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
            `;
            
            Object.entries(review.answers).forEach(([key, value]) => {
                contentHtml += `
                    <div class="modal-question">
                        <h4>${key.replace(/_/g, ' ')}</h4>
                        <div class="modal-answer">
                            ${value ? value.replace(/\n/g, '<br>') : 'No answer provided'}
                        </div>
                    </div>
                `;
            });
            
            contentHtml += `
                </div>
                <div class="modal-footer">
                    <button class="btn" onclick="exportSingleReview(${reviewId})">
                        <i class="fas fa-download"></i> Export This Review
                    </button>
                </div>
            `;
            
            modalContent.innerHTML = contentHtml;
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
        }
        
        function exportSingleReview(reviewId) {
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            const review = reviews.find(r => r.id === reviewId);
            
            if (!review) return;
            
            const exportContent = `
SelfMaster Review Export
========================
Review Type: ${review.title}
Date: ${new Date(review.date).toLocaleDateString()}

${Object.entries(review.answers).map(([key, value]) => `
${key.replace(/_/g, ' ').toUpperCase()}:
${value || 'No answer provided'}
${'-'.repeat(50)}
`).join('\n')}
            `;
            
            // Create download
            const blob = new Blob([exportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `review-${review.type}-${new Date(review.date).toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function deleteReview(reviewId) {
            if (confirm('Are you sure you want to delete this review? This action cannot be undone.')) {
                const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
                const updatedReviews = reviews.filter(r => r.id !== reviewId);
                localStorage.setItem('reviews', JSON.stringify(updatedReviews));
                
                loadReviewHistory();
                updateReviewInsights();
                loadActionItems();
                updateReviewStatistics();
                
                alert('Review deleted successfully!');
            }
        }
        
        function updateReviewInsights() {
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            
            if (reviews.length === 0) {
                document.getElementById('common-achievements').innerHTML = '<p>No data yet</p>';
                document.getElementById('common-challenges').innerHTML = '<p>No data yet</p>';
                document.getElementById('key-learnings').innerHTML = '<p>No data yet</p>';
                document.getElementById('progress-trend').innerHTML = '<p>No data yet</p>';
                return;
            }
            
            // Extract common themes (simplified version)
            const allAchievements = [];
            const allChallenges = [];
            const allLearnings = [];
            
            reviews.forEach(review => {
                if (review.answers.achievements) {
                    allAchievements.push(review.answers.achievements);
                }
                if (review.answers.challenges) {
                    allChallenges.push(review.answers.challenges);
                }
                if (review.answers.learnings || review.answers.lessons || review.answers.key_learnings) {
                    allLearnings.push(review.answers.learnings || review.answers.lessons || review.answers.key_learnings);
                }
            });
            
            // Display simplified insights
            document.getElementById('common-achievements').innerHTML = `
                <ul>
                    <li>Completed ${reviews.length} reviews</li>
                    <li>Generated ${reviews.reduce((sum, r) => sum + (r.actionItems ? r.actionItems.length : 0), 0)} action items</li>
                    <li>Most reviews on ${getMostActiveDay(reviews)}</li>
                </ul>
            `;
            
            document.getElementById('common-challenges').innerHTML = `
                <p>Based on ${reviews.length} reviews, common challenges include time management, focus, and consistency.</p>
            `;
            
            document.getElementById('key-learnings').innerHTML = `
                <p>Regular reviews improve self-awareness and goal alignment. ${reviews.length} reviews completed so far.</p>
            `;
            
            // Calculate trend (simplified)
            const weeklyReviews = reviews.filter(r => {
                const reviewDate = new Date(r.date);
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                return reviewDate >= oneWeekAgo;
            }).length;
            
            const previousWeeklyReviews = reviews.filter(r => {
                const reviewDate = new Date(r.date);
                const twoWeeksAgo = new Date();
                twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 14);
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                return reviewDate >= twoWeeksAgo && reviewDate < oneWeekAgo;
            }).length;
            
            let trend = 'stable';
            if (weeklyReviews > previousWeeklyReviews) trend = 'improving';
            if (weeklyReviews < previousWeeklyReviews) trend = 'declining';
            
            document.getElementById('progress-trend').innerHTML = `
                <div class="trend ${trend}">
                    <i class="fas fa-${trend === 'improving' ? 'arrow-up' : trend === 'declining' ? 'arrow-down' : 'minus'}"></i>
                    <span>Trend: ${trend}</span>
                </div>
            `;
        }
        
        function getMostActiveDay(reviews) {
            if (reviews.length === 0) return 'No data';
            
            const dayCount = {};
            reviews.forEach(review => {
                const day = new Date(review.date).getDay();
                dayCount[day] = (dayCount[day] || 0) + 1;
            });
            
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const maxDay = Object.keys(dayCount).reduce((a, b) => dayCount[a] > dayCount[b] ? a : b);
            return days[maxDay];
        }
        
        function loadActionItems() {
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            const allActionItems = [];
            
            reviews.forEach(review => {
                if (review.actionItems && Array.isArray(review.actionItems)) {
                    review.actionItems.forEach(item => {
                        allActionItems.push({
                            ...item,
                            reviewTitle: review.title,
                            reviewDate: review.date
                        });
                    });
                }
            });
            
            // Filter to incomplete items
            const incompleteItems = allActionItems.filter(item => !item.completed);
            
            const actionsList = document.getElementById('actions-list');
            
            if (incompleteItems.length === 0) {
                actionsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-check-circle fa-3x"></i>
                        <h3>No Pending Action Items</h3>
                        <p>All review action items have been completed!</p>
                    </div>
                `;
                return;
            }
            
            actionsList.innerHTML = incompleteItems.map(item => `
                <div class="action-item">
                    <div class="action-content">
                        <div class="action-text">
                            <h4>${item.text}</h4>
                            <p class="action-source">From: ${item.reviewTitle} • ${formatDate(new Date(item.reviewDate))}</p>
                        </div>
                        <div class="action-actions">
                            <button class="btn-small" onclick="completeActionItem('${item.id}')">
                                <i class="fas fa-check"></i> Complete
                            </button>
                            <button class="btn-small btn-outline" onclick="addToTasks('${item.id}')">
                                <i class="fas fa-tasks"></i> Add to Tasks
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function completeActionItem(itemId) {
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            
            // Find and mark the action item as completed
            reviews.forEach(review => {
                if (review.actionItems) {
                    const itemIndex = review.actionItems.findIndex(item => item.id == itemId);
                    if (itemIndex !== -1) {
                        review.actionItems[itemIndex].completed = true;
                    }
                }
            });
            
            localStorage.setItem('reviews', JSON.stringify(reviews));
            loadActionItems();
            updateReviewStatistics();
            
            alert('Action item marked as completed!');
        }
        
        function addToTasks(itemId) {
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            let actionItem = null;
            let reviewTitle = '';
            
            // Find the action item
            reviews.forEach(review => {
                if (review.actionItems) {
                    const item = review.actionItems.find(item => item.id == itemId);
                    if (item) {
                        actionItem = item;
                        reviewTitle = review.title;
                    }
                }
            });
            
            if (!actionItem) {
                alert('Action item not found');
                return;
            }
            
            // Add to tasks
            const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
            const task = {
                id: Date.now(),
                title: actionItem.text.substring(0, 100),
                description: `From review: ${reviewTitle}`,
                priority: 'medium',
                dueDate: null,
                completed: false,
                createdAt: new Date().toISOString(),
                tags: ['review', 'action-item']
            };
            
            tasks.push(task);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            alert('Action item added to your tasks!');
        }
        
        function updateReviewStatistics() {
            const reviews = JSON.parse(localStorage.getItem('reviews') || '[]');
            
            const totalReviews = reviews.length;
            
            // Calculate streak (simplified)
            let streak = 0;
            if (reviews.length > 0) {
                const sortedDates = reviews
                    .map(r => new Date(r.date))
                    .sort((a, b) => b - a);
                
                let currentStreak = 1;
                for (let i = 1; i < sortedDates.length; i++) {
                    const diffDays = Math.floor((sortedDates[i-1] - sortedDates[i]) / (1000 * 60 * 60 * 24));
                    if (diffDays <= 1) {
                        currentStreak++;
                    } else {
                        break;
                    }
                }
                streak = currentStreak;
            }
            
            // Calculate completion rate
            const allActionItems = reviews.reduce((items, review) => {
                return items.concat(review.actionItems || []);
            }, []);
            
            const completedItems = allActionItems.filter(item => item.completed).length;
            const completionRate = allActionItems.length > 0 ? 
                Math.round((completedItems / allActionItems.length) * 100) : 0;
            
            // Calculate consistency (reviews per week)
            const now = new Date();
            const fourWeeksAgo = new Date();
            fourWeeksAgo.setDate(now.getDate() - 28);
            
            const recentReviews = reviews.filter(r => {
                const reviewDate = new Date(r.date);
                return reviewDate >= fourWeeksAgo;
            }).length;
            
            const consistencyRate = Math.min(Math.round((recentReviews / 4) * 100), 100);
            
            document.getElementById('total-reviews').textContent = totalReviews;
            document.getElementById('review-streak').textContent = streak;
            document.getElementById('actions-completed').textContent = `${completionRate}%`;
            document.getElementById('consistency-rate').textContent = `${consistencyRate}%`;
        }
        
        function formatDate(date) {
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric',
                year: 'numeric'
            });
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadReviewHistory();
            updateReviewInsights();
            loadActionItems();
            updateReviewStatistics();
        });
    </script>
</body>
</html>