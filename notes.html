<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notes & Knowledge | SelfMaster</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/simplemde/1.11.2/simplemde.min.css">
    <script src="data.js"></script>
    <script src="script.js"></script>
</head>
<body>
    <header>
    <div class="container header-content">
        <div class="logo">
            <i class="fas fa-brain"></i>
            <span><a href="index.html" style="color: inherit; text-decoration: none;">SelfMaster</a></span>
        </div>
        <nav id="main-nav">
            <ul>
                <li><a href="tasks.html"><i class="fas fa-tasks"></i> Tasks</a></li>
                <li><a href="projects.html"><i class="fas fa-project-diagram"></i> Projects</a></li>
                <li><a href="calendar.html"><i class="fas fa-calendar"></i> Calendar</a></li>
                <li><a href="goals.html"><i class="fas fa-bullseye"></i> Goals</a></li>
                <li><a href="habits.html"><i class="fas fa-running"></i> Habits</a></li>
                <li><a href="notes.html"><i class="fas fa-sticky-note"></i> Notes</a></li>
                <li><a href="reviews.html"><i class="fas fa-chart-bar"></i> Reviews</a></li>
                <li><a href="analytics.html"><i class="fas fa-chart-line"></i> Analytics</a></li>
            </ul>
        </nav>
        <button class="mobile-menu-btn">
            <i class="fas fa-bars"></i>
        </button>
    </div>
</header>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1><i class="fas fa-sticky-note"></i> Notes & Knowledge Management</h1>
            <p>Capture ideas, organize information, and build your personal knowledge base</p>
        </div>
    </section>

    <!-- Quick Capture -->
    <section class="quick-capture">
        <div class="container">
            <div class="capture-card">
                <h3><i class="fas fa-bolt"></i> Quick Capture</h3>
                <form id="quick-note-form" onsubmit="captureQuickNote(event)">
                    <div class="form-group">
                        <input type="text" id="quick-note-title" placeholder="Note title...">
                    </div>
                    <div class="form-group">
                        <textarea id="quick-note-content" rows="3" placeholder="What's on your mind?"></textarea>
                    </div>
                    <div class="form-group">
                        <input type="text" id="quick-note-tags" placeholder="Add tags (comma separated)">
                    </div>
                    <button type="submit" class="btn">
                        <i class="fas fa-save"></i> Save Note
                    </button>
                </form>
            </div>
        </div>
    </section>

    <!-- Notes Editor -->
    <section class="notes-editor">
        <div class="container">
            <div class="editor-container">
                <div class="editor-toolbar">
                    <div class="editor-actions">
                        <button class="editor-btn" onclick="formatText('bold')">
                            <i class="fas fa-bold"></i>
                        </button>
                        <button class="editor-btn" onclick="formatText('italic')">
                            <i class="fas fa-italic"></i>
                        </button>
                        <button class="editor-btn" onclick="formatText('heading')">
                            <i class="fas fa-heading"></i>
                        </button>
                        <button class="editor-btn" onclick="insertList('unordered')">
                            <i class="fas fa-list-ul"></i>
                        </button>
                        <button class="editor-btn" onclick="insertList('ordered')">
                            <i class="fas fa-list-ol"></i>
                        </button>
                        <button class="editor-btn" onclick="insertLink()">
                            <i class="fas fa-link"></i>
                        </button>
                    </div>
                    <div class="editor-save">
                        <button class="btn" onclick="saveNote()">
                            <i class="fas fa-save"></i> Save Note
                        </button>
                    </div>
                </div>
                <div class="editor-content">
                    <div class="note-meta">
                        <input type="text" id="note-title" placeholder="Note Title" class="note-title-input">
                        <input type="text" id="note-tags" placeholder="Add tags..." class="note-tags-input">
                        <select id="note-notebook" class="note-notebook-select">
                            <option value="">Select Notebook</option>
                            <option value="ideas">Ideas</option>
                            <option value="meetings">Meetings</option>
                            <option value="learning">Learning</option>
                            <option value="personal">Personal</option>
                        </select>
                    </div>
                    <textarea id="note-editor" rows="15" placeholder="Start typing your note here..."></textarea>
                    <div class="note-preview" id="note-preview"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Notes Navigation -->
    <section class="notes-navigation">
        <div class="container">
            <div class="notes-sidebar">
                <div class="sidebar-section">
                    <h4><i class="fas fa-folder"></i> Notebooks</h4>
                    <ul class="notebook-list" id="notebook-list">
                        <li class="active" data-notebook="all">All Notes</li>
                        <li data-notebook="ideas">Ideas & Brainstorm</li>
                        <li data-notebook="meetings">Meeting Notes</li>
                        <li data-notebook="learning">Learning & Research</li>
                        <li data-notebook="personal">Personal Journal</li>
                        <li data-notebook="projects">Project Notes</li>
                    </ul>
                </div>
                <div class="sidebar-section">
                    <h4><i class="fas fa-tags"></i> Tags</h4>
                    <div class="tag-cloud" id="tag-cloud">
                        <!-- Tags will be loaded here -->
                    </div>
                </div>
                <div class="sidebar-section">
                    <h4><i class="fas fa-search"></i> Search</h4>
                    <div class="search-box">
                        <input type="text" id="note-search" placeholder="Search notes..." onkeyup="searchNotes()">
                        <i class="fas fa-search"></i>
                    </div>
                </div>
            </div>
            
            <div class="notes-list-container">
                <div class="notes-list-header">
                    <h3 id="current-notebook">All Notes</h3>
                    <div class="notes-sort">
                        <select id="notes-sort" onchange="loadNotes()">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="title">Title A-Z</option>
                            <option value="modified">Recently Modified</option>
                        </select>
                    </div>
                </div>
                
                <div class="notes-list" id="notes-list">
                    <!-- Notes will be loaded here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Note Statistics -->
    <section class="note-statistics">
        <div class="container">
            <div class="stats-grid">
                <div class="stats-card">
                    <div class="stat-icon">
                        <i class="fas fa-sticky-note"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="total-notes">0</div>
                        <div class="stat-label">Total Notes</div>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stat-icon">
                        <i class="fas fa-tags"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="total-tags">0</div>
                        <div class="stat-label">Unique Tags</div>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stat-icon">
                        <i class="fas fa-file-word"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="total-words">0</div>
                        <div class="stat-label">Total Words</div>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stat-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="recent-notes">0</div>
                        <div class="stat-label">Notes This Week</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Recent Notes -->
    <section class="recent-notes">
        <div class="container">
            <h2 class="section-title"><i class="fas fa-history"></i> Recent Notes</h2>
            <div class="recent-notes-grid" id="recent-notes-grid">
                <!-- Recent notes will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h4>SelfMaster</h4>
                    <p>Your comprehensive personal management system designed to help you take control of your life, build better habits, and achieve your goals.</p>
                </div>
                <div class="footer-column">
                    <h4>Note Features</h4>
                    <ul>
                        <li><a href="#">Rich Text Editor</a></li>
                        <li><a href="#">Tag System</a></li>
                        <li><a href="#">Search & Filter</a></li>
                        <li><a href="#">Export Options</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Note-taking Methods</h4>
                    <ul>
                        <li><a href="#">Cornell Method</a></li>
                        <li><a href="#">Zettelkasten</a></li>
                        <li><a href="#">Bullet Journaling</a></li>
                        <li><a href="#">Mind Mapping</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 SelfMaster. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simplemde/1.11.2/simplemde.min.js"></script>
    <script>
        // Notes page specific functionality
        let currentNoteId = null;
        let currentNotebook = 'all';
        let simpleMDE = null;
        
        // Initialize SimpleMDE editor
        document.addEventListener('DOMContentLoaded', function() {
            if (document.getElementById('note-editor')) {
                simpleMDE = new SimpleMDE({
                    element: document.getElementById('note-editor'),
                    spellChecker: false,
                    status: false,
                    placeholder: 'Start typing your note here...',
                    autoDownloadFontAwesome: false
                });
            }
            
            loadNotes();
            loadTagCloud();
            updateNoteStatistics();
            loadRecentNotes();
            
            // Notebook click handlers
            document.querySelectorAll('.notebook-list li').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.notebook-list li').forEach(li => {
                        li.classList.remove('active');
                    });
                    this.classList.add('active');
                    currentNotebook = this.dataset.notebook;
                    document.getElementById('current-notebook').textContent = this.textContent;
                    loadNotes();
                });
            });
        });
        
        function loadNotes() {
            const notes = JSON.parse(localStorage.getItem('notes') || '[]');
            const sortBy = document.getElementById('notes-sort').value;
            let filteredNotes = notes;
            
            // Filter by notebook
            if (currentNotebook !== 'all') {
                filteredNotes = notes.filter(note => note.notebook === currentNotebook);
            }
            
            // Sort notes
            filteredNotes.sort((a, b) => {
                switch(sortBy) {
                    case 'newest':
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    case 'oldest':
                        return new Date(a.createdAt) - new Date(b.createdAt);
                    case 'title':
                        return a.title.localeCompare(b.title);
                    case 'modified':
                        return new Date(b.updatedAt || b.createdAt) - new Date(a.updatedAt || a.createdAt);
                    default:
                        return 0;
                }
            });
            
            const notesList = document.getElementById('notes-list');
            
            if (filteredNotes.length === 0) {
                notesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-sticky-note fa-3x"></i>
                        <h3>No notes found</h3>
                        <p>${currentNotebook === 'all' ? 'Create your first note!' : 'No notes in this notebook.'}</p>
                    </div>
                `;
                return;
            }
            
            notesList.innerHTML = filteredNotes.map(note => `
                <div class="note-item" data-note-id="${note.id}">
                    <div class="note-item-header">
                        <h4>${note.title || 'Untitled Note'}</h4>
                        <div class="note-item-actions">
                            <button class="action-btn" onclick="editNote(${note.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn" onclick="deleteNote(${note.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="note-item-preview">
                        ${note.content ? note.content.substring(0, 150) + '...' : 'No content'}
                    </div>
                    <div class="note-item-footer">
                        <div class="note-tags">
                            ${note.tags ? note.tags.split(',').map(tag => `
                                <span class="note-tag">${tag.trim()}</span>
                            `).join('') : ''}
                        </div>
                        <div class="note-date">
                            ${formatDate(new Date(note.updatedAt || note.createdAt))}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function loadTagCloud() {
            const notes = JSON.parse(localStorage.getItem('notes') || '[]');
            const tagCount = {};
            
            notes.forEach(note => {
                if (note.tags) {
                    note.tags.split(',').forEach(tag => {
                        const trimmedTag = tag.trim().toLowerCase();
                        if (trimmedTag) {
                            tagCount[trimmedTag] = (tagCount[trimmedTag] || 0) + 1;
                        }
                    });
                }
            });
            
            const tagCloud = document.getElementById('tag-cloud');
            const sortedTags = Object.entries(tagCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20);
            
            if (sortedTags.length === 0) {
                tagCloud.innerHTML = '<p class="no-tags">No tags yet</p>';
                return;
            }
            
            tagCloud.innerHTML = sortedTags.map(([tag, count]) => {
                const size = Math.min(20 + (count * 2), 30);
                return `<span class="tag-item" style="font-size: ${size}px" onclick="filterByTag('${tag}')">${tag}</span>`;
            }).join('');
        }
        
        function filterByTag(tag) {
            document.getElementById('note-search').value = tag;
            searchNotes();
        }
        
        function searchNotes() {
            const searchTerm = document.getElementById('note-search').value.toLowerCase();
            const notes = JSON.parse(localStorage.getItem('notes') || '[]');
            
            const filteredNotes = notes.filter(note => {
                return note.title.toLowerCase().includes(searchTerm) ||
                       note.content.toLowerCase().includes(searchTerm) ||
                       (note.tags && note.tags.toLowerCase().includes(searchTerm));
            });
            
            const notesList = document.getElementById('notes-list');
            
            if (filteredNotes.length === 0) {
                notesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search fa-3x"></i>
                        <h3>No notes found</h3>
                        <p>No notes match your search criteria.</p>
                    </div>
                `;
                return;
            }
            
            notesList.innerHTML = filteredNotes.map(note => `
                <div class="note-item" data-note-id="${note.id}">
                    <div class="note-item-header">
                        <h4>${highlightText(note.title, searchTerm)}</h4>
                        <div class="note-item-actions">
                            <button class="action-btn" onclick="editNote(${note.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn" onclick="deleteNote(${note.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="note-item-preview">
                        ${highlightText(note.content.substring(0, 150) + '...', searchTerm)}
                    </div>
                    <div class="note-item-footer">
                        <div class="note-tags">
                            ${note.tags ? note.tags.split(',').map(tag => `
                                <span class="note-tag">${tag.trim()}</span>
                            `).join('') : ''}
                        </div>
                        <div class="note-date">
                            ${formatDate(new Date(note.updatedAt || note.createdAt))}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function highlightText(text, searchTerm) {
            if (!searchTerm || !text) return text;
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return text.replace(regex, '<mark>$1</mark>');
        }
        
        function captureQuickNote(event) {
            event.preventDefault();
            
            const title = document.getElementById('quick-note-title').value || 'Quick Note';
            const content = document.getElementById('quick-note-content').value;
            const tags = document.getElementById('quick-note-tags').value;
            
            const note = {
                id: Date.now(),
                title,
                content,
                tags,
                notebook: 'ideas',
                createdAt: new Date().toISOString()
            };
            
            const notes = JSON.parse(localStorage.getItem('notes') || '[]');
            notes.push(note);
            localStorage.setItem('notes', JSON.stringify(notes));
            
            // Reset form
            document.getElementById('quick-note-form').reset();
            
            // Reload notes
            loadNotes();
            loadTagCloud();
            updateNoteStatistics();
            loadRecentNotes();
            
            // Show success message
            showNotification('Note saved successfully!');
        }
        
        function saveNote() {
            if (!simpleMDE) return;
            
            const title = document.getElementById('note-title').value || 'Untitled Note';
            const content = simpleMDE.value();
            const tags = document.getElementById('note-tags').value;
            const notebook = document.getElementById('note-notebook').value || 'general';
            
            const note = {
                id: currentNoteId || Date.now(),
                title,
                content,
                tags,
                notebook,
                updatedAt: new Date().toISOString()
            };
            
            if (!currentNoteId) {
                note.createdAt = new Date().toISOString();
            }
            
            const notes = JSON.parse(localStorage.getItem('notes') || '[]');
            
            if (currentNoteId) {
                // Update existing note
                const index = notes.findIndex(n => n.id === currentNoteId);
                if (index !== -1) {
                    notes[index] = { ...notes[index], ...note };
                }
            } else {
                // Add new note
                notes.push(note);
                currentNoteId = note.id;
            }
            
            localStorage.setItem('notes', JSON.stringify(notes));
            
            // Reload notes
            loadNotes();
            loadTagCloud();
            updateNoteStatistics();
            loadRecentNotes();
            
            // Show success message
            showNotification('Note saved successfully!');
        }
        
        function editNote(noteId) {
            const notes = JSON.parse(localStorage.getItem('notes') || '[]');
            const note = notes.find(n => n.id === noteId);
            
            if (note) {
                currentNoteId = noteId;
                document.getElementById('note-title').value = note.title || '';
                document.getElementById('note-tags').value = note.tags || '';
                document.getElementById('note-notebook').value = note.notebook || '';
                
                if (simpleMDE) {
                    simpleMDE.value(note.content || '');
                }
                
                // Scroll to editor
                document.querySelector('.notes-editor').scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        function deleteNote(noteId) {
            if (confirm('Are you sure you want to delete this note? This action cannot be undone.')) {
                const notes = JSON.parse(localStorage.getItem('notes') || '[]');
                const updatedNotes = notes.filter(n => n.id !== noteId);
                localStorage.setItem('notes', JSON.stringify(updatedNotes));
                
                // If we're deleting the currently edited note, clear the editor
                if (currentNoteId === noteId) {
                    clearEditor();
                }
                
                loadNotes();
                loadTagCloud();
                updateNoteStatistics();
                loadRecentNotes();
                
                showNotification('Note deleted successfully!');
            }
        }
        
        function clearEditor() {
            currentNoteId = null;
            document.getElementById('note-title').value = '';
            document.getElementById('note-tags').value = '';
            document.getElementById('note-notebook').value = '';
            
            if (simpleMDE) {
                simpleMDE.value('');
            }
        }
        
        function updateNoteStatistics() {
            const notes = JSON.parse(localStorage.getItem('notes') || '[]');
            
            const totalNotes = notes.length;
            const totalWords = notes.reduce((sum, note) => {
                return sum + (note.content ? note.content.split(/\s+/).length : 0);
            }, 0);
            
            // Count unique tags
            const allTags = new Set();
            notes.forEach(note => {
                if (note.tags) {
                    note.tags.split(',').forEach(tag => {
                        allTags.add(tag.trim().toLowerCase());
                    });
                }
            });
            
            // Count notes from this week
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            const recentNotes = notes.filter(note => {
                const noteDate = new Date(note.createdAt);
                return noteDate >= oneWeekAgo;
            }).length;
            
            document.getElementById('total-notes').textContent = totalNotes;
            document.getElementById('total-tags').textContent = allTags.size;
            document.getElementById('total-words').textContent = totalWords.toLocaleString();
            document.getElementById('recent-notes').textContent = recentNotes;
        }
        
        function loadRecentNotes() {
            const notes = JSON.parse(localStorage.getItem('notes') || '[]');
            const recentNotes = notes
                .sort((a, b) => new Date(b.updatedAt || b.createdAt) - new Date(a.updatedAt || a.createdAt))
                .slice(0, 4);
            
            const recentNotesGrid = document.getElementById('recent-notes-grid');
            
            if (recentNotes.length === 0) {
                recentNotesGrid.innerHTML = `
                    <div class="empty-state">
                        <p>No notes yet. Create your first note!</p>
                    </div>
                `;
                return;
            }
            
            recentNotesGrid.innerHTML = recentNotes.map(note => `
                <div class="recent-note-card">
                    <div class="recent-note-header">
                        <h4>${note.title || 'Untitled Note'}</h4>
                        <span class="recent-note-date">${formatRelativeDate(new Date(note.updatedAt || note.createdAt))}</span>
                    </div>
                    <div class="recent-note-preview">
                        ${note.content ? note.content.substring(0, 100) + '...' : 'No content'}
                    </div>
                    <div class="recent-note-footer">
                        <div class="recent-note-tags">
                            ${note.tags ? note.tags.split(',').slice(0, 2).map(tag => `
                                <span class="note-tag">${tag.trim()}</span>
                            `).join('') : ''}
                        </div>
                        <button class="btn-small" onclick="editNote(${note.id})">
                            Open
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function formatDate(date) {
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric',
                year: 'numeric'
            });
        }
        
        function formatRelativeDate(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
            return formatDate(date);
        }
        
        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: var(--success);
                color: white;
                padding: 1rem 1.5rem;
                border-radius: var(--border-radius);
                box-shadow: var(--shadow-lg);
                z-index: 9999;
                animation: slideIn 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // Editor formatting functions
        function formatText(format) {
            if (!simpleMDE) return;
            
            const cm = simpleMDE.codemirror;
            const text = cm.getSelection();
            
            switch(format) {
                case 'bold':
                    cm.replaceSelection(`**${text}**`);
                    break;
                case 'italic':
                    cm.replaceSelection(`*${text}*`);
                    break;
                case 'heading':
                    cm.replaceSelection(`# ${text}`);
                    break;
            }
            
            cm.focus();
        }
        
        function insertList(type) {
            if (!simpleMDE) return;
            
            const cm = simpleMDE.codemirror;
            const marker = type === 'unordered' ? '- ' : '1. ';
            cm.replaceSelection(`${marker}`);
            cm.focus();
        }
        
        function insertLink() {
            if (!simpleMDE) return;
            
            const cm = simpleMDE.codemirror;
            const text = cm.getSelection() || 'link text';
            cm.replaceSelection(`[${text}](https://example.com)`);
            cm.focus();
        }
        
        // Add CSS for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>