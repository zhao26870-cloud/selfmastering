<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar | SelfMaster</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Additional styles for calendar page */
        .calendar-controls {
            background: white;
            padding: 1rem 0;
            margin-bottom: 1rem;
            box-shadow: var(--shadow);
        }
        
        .controls-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .view-selector {
            display: flex;
            gap: 0.5rem;
        }
        
        .view-btn {
            padding: 0.5rem 1.5rem;
            background: var(--gray-light);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .view-btn.active {
            background: var(--primary);
            color: white;
        }
        
        .date-navigation {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .nav-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gray-light);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .nav-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .current-date {
            font-weight: 600;
            min-width: 200px;
            text-align: center;
        }
        
        .calendar-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        /* Calendar Views */
        .calendar-container {
            position: relative;
            min-height: 500px;
        }
        
        .day-view,
        .week-view,
        .month-view {
            display: none;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
        }
        
        .day-view.active,
        .week-view.active,
        .month-view.active {
            display: block;
        }
        
        /* Day View */
        .time-schedule {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .time-slot {
            display: flex;
            border-bottom: 1px solid var(--gray-light);
            padding: 0.5rem 0;
        }
        
        .time-label {
            width: 80px;
            font-weight: 500;
            color: var(--gray);
        }
        
        .time-block-area {
            flex: 1;
            min-height: 60px;
            position: relative;
        }
        
        .scheduled-block {
            position: absolute;
            left: 0;
            right: 10px;
            background: var(--primary);
            color: white;
            border-radius: 5px;
            padding: 0.5rem;
            font-size: 0.9rem;
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .scheduled-block:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .block-content {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }
        
        /* Week View */
        .week-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
            text-align: center;
            font-weight: 600;
            color: var(--secondary);
        }
        
        .week-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            min-height: 400px;
        }
        
        .weekday {
            background: #f8f9ff;
            border-radius: 5px;
            padding: 0.5rem;
            text-align: center;
        }
        
        /* Month View */
        .month-header {
            text-align: center;
            margin-bottom: 1rem;
            color: var(--secondary);
        }
        
        .month-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }
        
        .month-day {
            height: 80px;
            background: #f8f9ff;
            border-radius: 5px;
            padding: 0.5rem;
            display: flex;
            align-items: flex-start;
            justify-content: flex-end;
            font-weight: 500;
        }
        
        .month-day.empty {
            background: transparent;
        }
        
        /* Time Block Form */
        .time-block-form-section {
            margin: 2rem 0;
        }
        
        .form-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow);
        }
        
        .color-picker {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            border: 2px solid var(--gray-light);
        }
        
        /* Upcoming Events */
        .upcoming-events {
            margin: 3rem 0;
        }
        
        .events-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .event-item {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }
        
        .event-time {
            min-width: 200px;
        }
        
        .event-date {
            font-weight: 600;
            color: var(--secondary);
        }
        
        .event-range {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .event-details {
            flex: 1;
        }
        
        .event-details h4 {
            margin-bottom: 0.5rem;
        }
        
        .event-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        /* Time Statistics */
        .time-statistics {
            margin: 3rem 0;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        
        .stats-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            background: var(--primary-light);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .stat-content {
            flex: 1;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--secondary);
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* Calendar Tips */
        .calendar-tips {
            margin: 3rem 0;
        }
        
        .tips-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
        }
        
        .tips-card h3 {
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .tips-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        
        .tip {
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: 10px;
            border-left: 4px solid var(--accent);
        }
        
        .tip h4 {
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--gray);
        }
        
        .empty-state i {
            margin-bottom: 1rem;
            color: var(--primary-light);
        }
        
        .section-title {
            margin-bottom: 2rem;
            color: var(--secondary);
        }
        
        @media (max-width: 768px) {
            .controls-bar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .view-selector {
                justify-content: center;
            }
            
            .calendar-actions {
                justify-content: center;
            }
            
            .event-item {
                flex-direction: column;
                align-items: stretch;
                text-align: center;
            }
            
            .event-time {
                min-width: auto;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tips-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-brain"></i>
                <span><a href="index.html" style="color: inherit; text-decoration: none;">SelfMaster</a></span>
            </div>
            <nav id="main-nav">
                <ul>
                    <li><a href="tasks.html"><i class="fas fa-tasks"></i> Tasks</a></li>
                    <li><a href="projects.html"><i class="fas fa-project-diagram"></i> Projects</a></li>
                    <li><a href="calendar.html"><i class="fas fa-calendar"></i> Calendar</a></li>
                    <li><a href="goals.html"><i class="fas fa-bullseye"></i> Goals</a></li>
                    <li><a href="habits.html"><i class="fas fa-running"></i> Habits</a></li>
                    <li><a href="notes.html"><i class="fas fa-sticky-note"></i> Notes</a></li>
                    <li><a href="reviews.html"><i class="fas fa-chart-bar"></i> Reviews</a></li>
                    <li><a href="analytics.html"><i class="fas fa-chart-line"></i> Analytics</a></li>
                </ul>
            </nav>
            <button class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1><i class="fas fa-calendar"></i> Calendar & Time Management</h1>
            <p>Plan your days with time blocking and schedule optimization</p>
        </div>
    </section>

    <!-- Calendar Controls -->
    <section class="calendar-controls">
        <div class="container">
            <div class="controls-bar">
                <div class="view-selector">
                    <button class="view-btn active" data-view="day">Day</button>
                    <button class="view-btn" data-view="week">Week</button>
                    <button class="view-btn" data-view="month">Month</button>
                </div>
                <div class="date-navigation">
                    <button class="nav-btn" id="prev-date">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="current-date" id="current-date">Today</div>
                    <button class="nav-btn" id="next-date">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="calendar-actions">
                    <button class="btn" onclick="showTimeBlockForm()">
                        <i class="fas fa-clock"></i> Time Block
                    </button>
                    <button class="btn btn-outline" onclick="syncWithExternal()">
                        <i class="fas fa-sync"></i> Sync Calendar
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Calendar View -->
    <section class="calendar-view">
        <div class="container">
            <div class="calendar-container">
                <!-- Day View (Default) -->
                <div class="day-view active" id="day-view">
                    <div class="time-schedule" id="time-schedule">
                        <!-- Time slots will be generated here -->
                    </div>
                </div>
                
                <!-- Week View -->
                <div class="week-view" id="week-view">
                    <div class="week-header" id="week-header">
                        <!-- Day headers will be generated here -->
                    </div>
                    <div class="week-grid" id="week-grid">
                        <!-- Week grid will be generated here -->
                    </div>
                </div>
                
                <!-- Month View -->
                <div class="month-view" id="month-view">
                    <div class="month-header" id="month-header">
                        <!-- Month header will be generated here -->
                    </div>
                    <div class="month-grid" id="month-grid">
                        <!-- Month grid will be generated here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Time Blocking Form -->
    <section class="time-block-form-section">
        <div class="container">
            <div class="form-container" id="time-block-form" style="display: none;">
                <h3><i class="fas fa-clock"></i> Create Time Block</h3>
                <form id="time-block-form-elements" onsubmit="createTimeBlock(event)">
                    <div class="form-group">
                        <label for="block-title">Title *</label>
                        <input type="text" id="block-title" placeholder="What are you working on?" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="block-date">Date</label>
                            <input type="date" id="block-date" value="">
                        </div>
                        <div class="form-group">
                            <label for="block-start">Start Time</label>
                            <input type="time" id="block-start" value="09:00">
                        </div>
                        <div class="form-group">
                            <label for="block-end">End Time</label>
                            <input type="time" id="block-end" value="10:00">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="block-category">Category</label>
                        <select id="block-category">
                            <option value="work">Work</option>
                            <option value="personal">Personal</option>
                            <option value="learning">Learning</option>
                            <option value="health">Health</option>
                            <option value="social">Social</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="block-color">Color Code</label>
                        <div class="color-picker">
                            <input type="color" id="block-color" value="#4361ee">
                            <span class="color-preview" id="color-preview" style="background-color: #4361ee;"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="block-notes">Notes</label>
                        <textarea id="block-notes" rows="3" placeholder="Additional notes..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn">Create Time Block</button>
                        <button type="button" class="btn btn-outline" onclick="hideTimeBlockForm()">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- Upcoming Events -->
    <section class="upcoming-events">
        <div class="container">
            <h2 class="section-title"><i class="fas fa-calendar-alt"></i> Upcoming Events</h2>
            <div class="events-list" id="events-list">
                <!-- Events will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Time Statistics -->
    <section class="time-statistics">
        <div class="container">
            <h2 class="section-title"><i class="fas fa-chart-bar"></i> Time Statistics</h2>
            <div class="stats-grid">
                <div class="stats-card">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="total-scheduled">0h</div>
                        <div class="stat-label">Scheduled Today</div>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="completed-today">0%</div>
                        <div class="stat-label">Completion Rate</div>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stat-icon">
                        <i class="fas fa-balance-scale"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="time-balance">0h</div>
                        <div class="stat-label">Free Time Today</div>
                    </div>
                </div>
                <div class="stats-card">
                    <div class="stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-value" id="productivity-trend">+0%</div>
                        <div class="stat-label">Weekly Trend</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Calendar Tips -->
    <section class="calendar-tips">
        <div class="container">
            <div class="tips-card">
                <h3><i class="fas fa-lightbulb"></i> Time Management Tips</h3>
                <div class="tips-content">
                    <div class="tip">
                        <h4><i class="fas fa-clock"></i> Time Blocking</h4>
                        <p>Schedule your most important tasks during your peak productivity hours.</p>
                    </div>
                    <div class="tip">
                        <h4><i class="fas fa-umbrella-beach"></i> Buffer Time</h4>
                        <p>Always include 15-30 minute buffers between scheduled blocks for transitions.</p>
                    </div>
                    <div class="tip">
                        <h4><i class="fas fa-tasks"></i> Theme Days</h4>
                        <p>Assign specific themes to different days (e.g., Monday: Planning, Tuesday: Deep Work).</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h4>SelfMaster</h4>
                    <p>Your comprehensive personal management system designed to help you take control of your life, build better habits, and achieve your goals.</p>
                </div>
                <div class="footer-column">
                    <h4>Calendar Features</h4>
                    <ul>
                        <li><a href="#">Time Blocking</a></li>
                        <li><a href="#">Calendar Sync</a></li>
                        <li><a href="#">Recurring Events</a></li>
                        <li><a href="#">Smart Scheduling</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4>Integrations</h4>
                    <ul>
                        <li><a href="#">Google Calendar</a></li>
                        <li><a href="#">Outlook Calendar</a></li>
                        <li><a href="#">Apple Calendar</a></li>
                        <li><a href="#">Task Apps</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 SelfMaster. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script src="data.js"></script>
    <script>
        // Calendar page specific functionality
        let currentDate = new Date();
        let currentView = 'day';
        
        function formatDate(date) {
            return date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }
        
        function updateCurrentDateDisplay() {
            document.getElementById('current-date').textContent = formatDate(currentDate);
            document.getElementById('block-date').value = currentDate.toISOString().split('T')[0];
            loadCalendarView();
        }
        
        function changeView(view) {
            currentView = view;
            
            // Update active button
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Show/hide views
            document.querySelectorAll('.day-view, .week-view, .month-view').forEach(view => {
                view.classList.remove('active');
            });
            document.getElementById(`${view}-view`).classList.add('active');
            
            loadCalendarView();
        }
        
        function loadCalendarView() {
            switch(currentView) {
                case 'day':
                    loadDayView();
                    break;
                case 'week':
                    loadWeekView();
                    break;
                case 'month':
                    loadMonthView();
                    break;
            }
            loadUpcomingEvents();
            updateTimeStatistics();
        }
        
        function loadDayView() {
            const timeSchedule = document.getElementById('time-schedule');
            if (!timeSchedule) return;
            
            // Generate time slots for the day (6 AM to 10 PM)
            let timeSlotsHTML = '';
            for (let hour = 6; hour <= 22; hour++) {
                const timeLabel = `${hour.toString().padStart(2, '0')}:00`;
                timeSlotsHTML += `
                    <div class="time-slot">
                        <div class="time-label">${timeLabel}</div>
                        <div class="time-block-area" data-hour="${hour}"></div>
                    </div>
                `;
            }
            
            timeSchedule.innerHTML = timeSlotsHTML;
            loadTimeBlocksForDay();
        }
        
        function loadTimeBlocksForDay() {
            const timeBlocks = JSON.parse(localStorage.getItem('timeBlocks') || '[]');
            const today = currentDate.toISOString().split('T')[0];
            
            const todayBlocks = timeBlocks.filter(block => {
                const blockDate = new Date(block.startTime).toISOString().split('T')[0];
                return blockDate === today;
            });
            
            todayBlocks.forEach(block => {
                const startTime = new Date(block.startTime);
                const endTime = new Date(block.endTime);
                const startHour = startTime.getHours();
                const startMinute = startTime.getMinutes();
                const durationHours = (endTime - startTime) / (1000 * 60 * 60);
                
                const timeBlockElement = document.querySelector(`[data-hour="${startHour}"] .time-block-area`);
                if (timeBlockElement) {
                    const blockHTML = `
                        <div class="scheduled-block" style="
                            background-color: ${block.color || '#4361ee'};
                            height: ${durationHours * 60}px;
                            margin-top: ${startMinute}px;
                        " onclick="editTimeBlock(${block.id})">
                            <div class="block-content">
                                <strong>${block.title}</strong>
                                <small>${formatTime(startTime)} - ${formatTime(endTime)}</small>
                            </div>
                        </div>
                    `;
                    timeBlockElement.innerHTML += blockHTML;
                }
            });
        }
        
        function loadWeekView() {
            const weekHeader = document.getElementById('week-header');
            const weekGrid = document.getElementById('week-grid');
            
            if (!weekHeader || !weekGrid) return;
            
            // Get start of week (Sunday)
            const startOfWeek = new Date(currentDate);
            startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());
            
            // Generate week header
            let headerHTML = '';
            let gridHTML = '';
            
            for (let i = 0; i < 7; i++) {
                const day = new Date(startOfWeek);
                day.setDate(startOfWeek.getDate() + i);
                
                const dayName = day.toLocaleDateString('en-US', { weekday: 'short' });
                const dateNum = day.getDate();
                
                headerHTML += `<div class="weekday">${dayName}<br>${dateNum}</div>`;
                
                // Get time blocks for this day
                const dayBlocks = getTimeBlocksForDate(day);
                let dayBlocksHTML = '';
                
                dayBlocks.forEach(block => {
                    const startTime = new Date(block.startTime);
                    const endTime = new Date(block.endTime);
                    
                    dayBlocksHTML += `
                        <div class="scheduled-block" style="
                            background-color: ${block.color || '#4361ee'};
                            margin: 2px 0;
                            padding: 2px 4px;
                            font-size: 0.8rem;
                        " onclick="editTimeBlock(${block.id})">
                            <strong>${block.title}</strong>
                            <div>${formatTime(startTime)}-${formatTime(endTime)}</div>
                        </div>
                    `;
                });
                
                gridHTML += `<div class="weekday">${dayBlocksHTML}</div>`;
            }
            
            weekHeader.innerHTML = headerHTML;
            weekGrid.innerHTML = gridHTML;
        }
        
        function loadMonthView() {
            const monthHeader = document.getElementById('month-header');
            const monthGrid = document.getElementById('month-grid');
            
            if (!monthHeader || !monthGrid) return;
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            
            // Month header
            monthHeader.innerHTML = `<h3>${currentDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</h3>`;
            
            // Generate calendar grid
            const daysInMonth = lastDay.getDate();
            const startDay = firstDay.getDay();
            
            let monthHTML = '';
            
            // Empty cells for days before the first of the month
            for (let i = 0; i < startDay; i++) {
                monthHTML += '<div class="month-day empty"></div>';
            }
            
            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dayBlocks = getTimeBlocksForDate(date);
                
                let dayContent = `<div class="day-number">${day}</div>`;
                
                if (dayBlocks.length > 0) {
                    dayContent += `<div class="day-blocks">${dayBlocks.slice(0, 2).map(block => 
                        `<div class="month-block" style="background-color: ${block.color || '#4361ee'}"></div>`
                    ).join('')}</div>`;
                }
                
                monthHTML += `<div class="month-day" onclick="selectDay(${year}, ${month}, ${day})">${dayContent}</div>`;
            }
            
            monthGrid.innerHTML = monthHTML;
        }
        
        function getTimeBlocksForDate(date) {
            const timeBlocks = JSON.parse(localStorage.getItem('timeBlocks') || '[]');
            const dateString = date.toISOString().split('T')[0];
            
            return timeBlocks.filter(block => {
                const blockDate = new Date(block.startTime).toISOString().split('T')[0];
                return blockDate === dateString;
            });
        }
        
        function loadUpcomingEvents() {
            const eventsList = document.getElementById('events-list');
            if (!eventsList) return;
            
            const timeBlocks = JSON.parse(localStorage.getItem('timeBlocks') || '[]');
            const now = new Date();
            const upcomingBlocks = timeBlocks
                .filter(block => new Date(block.startTime) > now)
                .sort((a, b) => new Date(a.startTime) - new Date(b.startTime))
                .slice(0, 5);
            
            if (upcomingBlocks.length === 0) {
                eventsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar-plus fa-3x"></i>
                        <h3>No upcoming events</h3>
                        <p>Schedule your first time block to get started!</p>
                    </div>
                `;
                return;
            }
            
            eventsList.innerHTML = upcomingBlocks.map(block => `
                <div class="event-item">
                    <div class="event-time">
                        <div class="event-date">${formatDate(new Date(block.startTime))}</div>
                        <div class="event-range">${formatTime(new Date(block.startTime))} - ${formatTime(new Date(block.endTime))}</div>
                    </div>
                    <div class="event-details">
                        <h4>${block.title}</h4>
                        <p>${block.category || 'No category'}</p>
                        ${block.notes ? `<small>${block.notes}</small>` : ''}
                    </div>
                    <div class="event-actions">
                        <button class="action-btn" onclick="editTimeBlock(${block.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="action-btn" onclick="deleteTimeBlock(${block.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function updateTimeStatistics() {
            const today = new Date().toISOString().split('T')[0];
            const timeBlocks = JSON.parse(localStorage.getItem('timeBlocks') || '[]');
            
            const todayBlocks = timeBlocks.filter(block => {
                const blockDate = new Date(block.startTime).toISOString().split('T')[0];
                return blockDate === today;
            });
            
            const totalHours = todayBlocks.reduce((total, block) => {
                const start = new Date(block.startTime);
                const end = new Date(block.endTime);
                return total + (end - start) / (1000 * 60 * 60);
            }, 0);
            
            const completedBlocks = todayBlocks.filter(block => block.completed);
            const completionRate = todayBlocks.length > 0 ? 
                Math.round((completedBlocks.length / todayBlocks.length) * 100) : 0;
            
            const freeHours = 16 - totalHours; // Assuming 16 waking hours
            const freeHoursDisplay = freeHours > 0 ? `${freeHours.toFixed(1)}h` : '0h';
            
            // Simple trend calculation
            const trend = Math.round(Math.random() * 20) - 10;
            const trendDisplay = (trend >= 0 ? '+' : '') + trend + '%';
            
            document.getElementById('total-scheduled').textContent = `${totalHours.toFixed(1)}h`;
            document.getElementById('completed-today').textContent = `${completionRate}%`;
            document.getElementById('time-balance').textContent = freeHoursDisplay;
            document.getElementById('productivity-trend').textContent = trendDisplay;
            
            // Color code trend
            const trendElement = document.getElementById('productivity-trend');
            trendElement.className = trend >= 0 ? 'positive' : 'negative';
        }
        
        function showTimeBlockForm() {
            document.getElementById('time-block-form').style.display = 'block';
            // Set default date to current view date
            document.getElementById('block-date').value = currentDate.toISOString().split('T')[0];
        }
        
        function hideTimeBlockForm() {
            document.getElementById('time-block-form').style.display = 'none';
            document.getElementById('time-block-form-elements').reset();
        }
        
        function createTimeBlock(event) {
            event.preventDefault();
            
            const title = document.getElementById('block-title').value;
            const date = document.getElementById('block-date').value;
            const startTime = document.getElementById('block-start').value;
            const endTime = document.getElementById('block-end').value;
            const category = document.getElementById('block-category').value;
            const color = document.getElementById('block-color').value;
            const notes = document.getElementById('block-notes').value;
            
            const startDateTime = new Date(`${date}T${startTime}`);
            const endDateTime = new Date(`${date}T${endTime}`);
            
            if (endDateTime <= startDateTime) {
                alert('End time must be after start time');
                return;
            }
            
            const timeBlock = {
                id: Date.now(),
                title,
                startTime: startDateTime.toISOString(),
                endTime: endDateTime.toISOString(),
                category,
                color,
                notes,
                completed: false,
                createdAt: new Date().toISOString()
            };
            
            const timeBlocks = JSON.parse(localStorage.getItem('timeBlocks') || '[]');
            timeBlocks.push(timeBlock);
            localStorage.setItem('timeBlocks', JSON.stringify(timeBlocks));
            
            hideTimeBlockForm();
            loadCalendarView();
            
            alert('Time block created successfully!');
        }
        
        function editTimeBlock(blockId) {
            const timeBlocks = JSON.parse(localStorage.getItem('timeBlocks') || '[]');
            const block = timeBlocks.find(b => b.id === blockId);
            
            if (block) {
                // Populate form with block data
                document.getElementById('block-title').value = block.title;
                document.getElementById('block-date').value = new Date(block.startTime).toISOString().split('T')[0];
                document.getElementById('block-start').value = new Date(block.startTime).toTimeString().slice(0,5);
                document.getElementById('block-end').value = new Date(block.endTime).toTimeString().slice(0,5);
                document.getElementById('block-category').value = block.category || 'work';
                document.getElementById('block-color').value = block.color || '#4361ee';
                document.getElementById('color-preview').style.backgroundColor = block.color || '#4361ee';
                document.getElementById('block-notes').value = block.notes || '';
                
                // Show form in edit mode
                showTimeBlockForm();
                
                // Update form submit handler to edit instead of create
                const form = document.getElementById('time-block-form-elements');
                form.onsubmit = function(e) {
                    e.preventDefault();
                    updateTimeBlock(blockId);
                };
                
                // Update button text
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Update Time Block';
            }
        }
        
        function updateTimeBlock(blockId) {
            const title = document.getElementById('block-title').value;
            const date = document.getElementById('block-date').value;
            const startTime = document.getElementById('block-start').value;
            const endTime = document.getElementById('block-end').value;
            const category = document.getElementById('block-category').value;
            const color = document.getElementById('block-color').value;
            const notes = document.getElementById('block-notes').value;
            
            const startDateTime = new Date(`${date}T${startTime}`);
            const endDateTime = new Date(`${date}T${endTime}`);
            
            if (endDateTime <= startDateTime) {
                alert('End time must be after start time');
                return;
            }
            
            const timeBlocks = JSON.parse(localStorage.getItem('timeBlocks') || '[]');
            const blockIndex = timeBlocks.findIndex(b => b.id === blockId);
            
            if (blockIndex !== -1) {
                timeBlocks[blockIndex] = {
                    ...timeBlocks[blockIndex],
                    title,
                    startTime: startDateTime.toISOString(),
                    endTime: endDateTime.toISOString(),
                    category,
                    color,
                    notes,
                    updatedAt: new Date().toISOString()
                };
                
                localStorage.setItem('timeBlocks', JSON.stringify(timeBlocks));
                
                hideTimeBlockForm();
                loadCalendarView();
                
                alert('Time block updated successfully!');
            }
        }
        
        function deleteTimeBlock(blockId) {
            if (confirm('Are you sure you want to delete this time block?')) {
                const timeBlocks = JSON.parse(localStorage.getItem('timeBlocks') || '[]');
                const updatedBlocks = timeBlocks.filter(block => block.id !== blockId);
                localStorage.setItem('timeBlocks', JSON.stringify(updatedBlocks));
                loadCalendarView();
                alert('Time block deleted successfully!');
            }
        }
        
        function selectDay(year, month, day) {
            currentDate = new Date(year, month, day);
            currentView = 'day';
            
            // Update view buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.view === 'day') {
                    btn.classList.add('active');
                }
            });
            
            // Update views
            document.querySelectorAll('.day-view, .week-view, .month-view').forEach(view => {
                view.classList.remove('active');
            });
            document.getElementById('day-view').classList.add('active');
            
            updateCurrentDateDisplay();
        }
        
        function syncWithExternal() {
            // This would integrate with external calendar APIs
            alert('Calendar sync feature would connect with Google Calendar, Outlook, etc.');
        }
        
        function formatTime(date) {
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        
        // Initialize calendar
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize sample data if needed
            if (typeof SelfMasterData !== 'undefined') {
                SelfMasterData.initializeSampleData();
            }
            
            // Mobile menu
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            const nav = document.querySelector('nav ul');
            
            if (mobileMenuBtn && nav) {
                mobileMenuBtn.addEventListener('click', function() {
                    nav.classList.toggle('show');
                    mobileMenuBtn.innerHTML = nav.classList.contains('show') 
                        ? '<i class="fas fa-times"></i>' 
                        : '<i class="fas fa-bars"></i>';
                });
            }
            
            updateCurrentDateDisplay();
            
            // View button handlers
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    changeView(this.dataset.view);
                });
            });
            
            // Date navigation
            document.getElementById('prev-date').addEventListener('click', function() {
                if (currentView === 'day') {
                    currentDate.setDate(currentDate.getDate() - 1);
                } else if (currentView === 'week') {
                    currentDate.setDate(currentDate.getDate() - 7);
                } else {
                    currentDate.setMonth(currentDate.getMonth() - 1);
                }
                updateCurrentDateDisplay();
            });
            
            document.getElementById('next-date').addEventListener('click', function() {
                if (currentView === 'day') {
                    currentDate.setDate(currentDate.getDate() + 1);
                } else if (currentView === 'week') {
                    currentDate.setDate(currentDate.getDate() + 7);
                } else {
                    currentDate.setMonth(currentDate.getMonth() + 1);
                }
                updateCurrentDateDisplay();
            });
            
            // Color picker preview
            const colorInput = document.getElementById('block-color');
            const colorPreview = document.getElementById('color-preview');
            if (colorInput && colorPreview) {
                colorInput.addEventListener('input', function() {
                    colorPreview.style.backgroundColor = this.value;
                });
            }
            
            // Set default date for new time blocks
            document.getElementById('block-date').value = currentDate.toISOString().split('T')[0];
        });
    </script>
</body>
</html>